<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    <title>Title</title>

    <!-- <link rel="manifest" href="/assets/site.webmanifest"> -->
    <!-- <meta name="msapplication-TileColor" content="#da532c"> -->
    <base href = "http://localhost:8080/" />

    <meta name="theme-color" content="#ffffff">

    <!-- <link href="//fonts.googleapis.com/css?family=Titillium+Web:700|Source+Serif+Pro:400,700|Merriweather+Sans:400,700|Source+Sans+Pro:400,300,600,700,300italic,400italic,600italic,700italic" rel="stylesheet" type="text/css"> -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="elm.js"></script>
  </head>
  <body>
    <script>

    var sessionToken = localStorage.getItem('sessionToken') || "";

    var flags = { csrfToken : "csrfToken", sessionToken : sessionToken }

    var app = Elm.Main.init({
        flags: flags
    });

     app.ports.storeSession.subscribe(function(token) {
        localStorage.setItem('sessionToken', token);
        console.log("Saved state: ", token);
     });

     app.ports.play.subscribe(function() {

         let audio = document.getElementById("hls-audio");
         console.log(audio)
         audio.play()

     });

     app.ports.pause.subscribe(function() {

         let audio = document.getElementById("hls-audio");
         console.log(audio)
         audio.pause()

     });

    app.ports.initialize.subscribe(function(url) {

        console.log(url)
        let audio = document.getElementById("hls-audio");

        console.log(audio)
        let source = url

        if (Hls.isSupported()) {
            console.log("hls supported");

            let hls = new Hls();
            hls.loadSource(source);
            hls.attachMedia(audio);

            hls.on(Hls.Events.MEDIA_ATTACHED,function() {
                console.log("video and hls.js are now bound together !");
                audio.play();
            });
        }
    });

    </script>
  </body>
</html>
